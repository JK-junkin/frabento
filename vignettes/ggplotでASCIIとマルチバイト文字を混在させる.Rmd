---
title: "ggplotでASCIIとマルチバイト文字を混在させる"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ggplotでASCIIとマルチバイト文字を混在させる}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10/2.54,
  dpi = 96
)
```

## はじめに
- 世間的には (?) 特殊な事例かもしれませんが, `ggplot2` で作図を行う時, 
  英数字と日本語が混ざったラベル—例えば**CPUE (/1000網)**—のフォントを英数字と日本語で
  別にしてください, という指摘を受けることがあります.
- ggplotのタイトルや軸ラベル, 凡例ラベルのフォントをそれぞれ個別に指定することはできますが,
  例えば凡例ラベル内で複数のフォントを混在させるのは少し手間がかかります.
- ここで紹介する`frabento::mixfonts()`は[stack overflow](https://stackoverflow.com/questions/52852882/use-different-font-sizes-for-different-portions-of-text-in-ggplot2-title) の投稿を参考に作成した関数です.
  `ggtext` `r emo::ji("package")` のみの使用では長ったらしくなる`<span>`タグの付与を簡略化して, タイピングコストを下げられます.

## 使用例
```{r setup, echo = -7, eval = -1}
devtools::install_github("Gedevan-Aleksizde/fontregisterer", upgrade = "never")
library(frabento)       # このパッケージ
library(fontregisterer) # フォントの利用を楽にするため
library(ggtext)         # element_markdown() を使うため
library(tidyverse)      # ggplot2とtidyなデータハンドリング
library(patchwork)      # ggplotを簡単, キレイにレイアウト 
library(emo)
```

### 基本的な使用例: 軸タイトル
`mixfonts()`では, デフォルトのASCII文字フォントを**Arial**,
マルチバイト文字フォントを**MS Gothic**にしています.

```{r eg1, fig.asp = 1/2}
theme_set(theme_linedraw(base_family = "MS Gothic"))

# 仮想データ作成
dat <- tibble::tibble(cpue = rnorm(n = 30, mean = 500, sd = 35),
                      year = seq(1990, length.out = 30, by = 1))

# まずはmixfontsを使わない
g <- ggplot(data = dat, aes(x = year, y = cpue)) +
    geom_path() + geom_point() +
    labs(x = "年", y = "CPUE (/1000網)") +
    theme(axis.title.y = element_text(color = "blue"),
          aspect.ratio = 1/1) # アスペクト (縦横) 比

# mixfontsを使うと
gm <- g + labs(y = mixfonts("CPUE (/1000網)")) +
    theme(axis.title.y = ggtext::element_markdown(angle = 90, color = "blue"))

# use patchwork
g | gm

```

フォントを変更してみます. `fontregisterer` `r emo::ji("package")` が威力を発揮します.

```{r eg2, fig.width = 15/2.54, fig.asp = 1/3} 
gm1 <- gm + labs(y = mixfonts("CPUE (/1000網)", asciifont = "Cambria"))
gm2 <- gm + labs(y = mixfonts("CPUE (/1000網)", mbytefont = "Meiryo"))
gm3 <- gm + labs(y = mixfonts("CPUE (/1000網)",
                              ascii = "InconsolataForPowerline-g",
                              mbyte = "ToppanBunkyuMidashiGothicStdN-ExtraBold"))

# patchwork
gm1 + gm2 + gm3 + plot_layout(ncol = 3)
```

文字列の折り返しもできます. 

```{r eg3, fig.asp = 8/10, fig.width = 12/2.54}
# 折り返したい位置に改行記号 `\n` を挿入
gm4 <- gm + labs(y = mixfonts("A海区における\n大中型まき網漁業の\nCPUE (/1000網)"))

# mixfont() を使わなくても折り返しはできるが, フォントは混在できない.
g_  <- g + labs(y = "A海区における\n大中型まき網漁業の\nCPUE (/1000網)")

# フォントを変更すると日本語部分が豆腐化 --> 上書したフォントが優勢になる.
g__ <- g_ + theme(axis.title.y = element_text(family = "Arial"))

# patchwork
gm4 + plot_spacer() + g_ + g__ + plot_layout(ncol = 2, byrow = TRUE)
```

### 使用例2: 凡例
